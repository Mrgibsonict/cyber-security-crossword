function CPMakePoint(e,t){return{x:e,y:t}}CPNotification=function(e){this.name=e.name,this.object=e.object,this.userInfo=e.userInfo},CPDefaultNotificationCenter=null,CPNotificationCenter=function(){this._registry={}},CPNotificationCenter.prototype.addObserverForNotification=function(e){this._registry[e.name]===undefined&&(this._registry[e.name]=[]);var t=new CPNotification({name:e.name,object:e.object,userInfo:e.userInfo});this._registry[e.name].push({observer:e.observer,notification:t,action:e.action})},CPNotificationCenter.prototype.removeObserver=function(e){for(var t in this._registry)this.removeObserverForNotificationName(t)},CPNotificationCenter.prototype.removeObserverForNotificationName=function(e,t){var n=this._registry[t];if(n){var r=n.length,i=0;for(;i<r;i++){var s=n[i];s.observer===e&&n.removeObjectAtIndex(i)}}},CPNotificationCenter.prototype.removeObserverForNotificationNameAndObject=function(e,t,n){var r=this._registry[t];if(r){var i=r.length,s=0;for(;s<i;s++){var o=r[s];o.observer===e&&o.notification.object===n&&r.removeObjectAtIndex(s)}}},CPNotificationCenter.prototype.postNotificationName=function(e,t,n){if(this._registry[e]!==undefined){var r=this._registry[e],i=r.length,s=0;for(;s<i;s++){var o=r[s],u=o.observer;typeof u[o.action]=="function"&&(o.notification.object===t||o.notification.object===null)&&(n&&(o.notification.userInfo=n),u[o.action].call(u,o.notification))}}},CPNotificationCenter.defaultCenter=function(){return CPDefaultNotificationCenter||(CPDefaultNotificationCenter=new CPNotificationCenter),CPDefaultNotificationCenter},String.prototype.reverse=function(){return this.split("").reverse().join("")};var WordsearchView=function(e){this.puzzleObject=e.puzzleObject,this.cellSize=e.cellSize,this.el=$("#puzzle"),this.startPos=CPMakePoint(0,0),this.endPos=null,this.selectionDir=0,this.selectionLen=0,this._revealcount=0,this.selectedCell=null,this._mouseDragTimer=null,this._isMouseDown=!1;var t=this;this.el.bind("vmousedown",function(e){t._isMouseDown=!0;var n=e.clientX-t.el.offset().left-5,r=e.clientY-t.el.offset().top-5,i=Math.floor(n/t.cellSize)+t.puzzleObject.rect.origin.x,s=Math.floor(r/t.cellSize)+t.puzzleObject.rect.origin.y;t.selectedCell=t.puzzleObject.cells[i+","+s],t.startPos=CPMakePoint(i*t.cellSize+12,s*t.cellSize+26)}),$(document).bind("vmouseup",function(e){t._isMouseDown=!1,t._mouseDragTimer&&(clearTimeout(this._mouseDragTimer),this._mouseDragTimer=null);if(t.selectedCell){var n=t.getSelection(t.selectedCell,t.selectionDir,t.selectionLen);if(n){var r=t.checkSelection(t.selectedCell,n);r&&(r.revealed=!0,t._revealcount++,t.onWordFound(),t.isSolved()&&t.solve())}}t.endPos=null,t.startPos=null,t.selectedCell=null,t.display()}),this.el.bind("mousemove",function(e){if(t._isMouseDown&&t.startPos){var n=e.clientX-t.el.offset().left-5,r=e.clientY-t.el.offset().top;t._mouseDragTimer&&(clearTimeout(t._mouseDragTimer),t._mouseDragTimer=null),t._mouseDragTimer=setTimeout(function(){if(t.startPos)if(t.startPos.x>0&&t.startPos.y>0){var e=Math.abs(n-t.startPos.x),i=Math.abs(r-t.startPos.y),s=0;if(n>t.startPos.x&&r<t.startPos.y){var o=Math.atan(i/e);s=90-o*180/Math.PI}else if(n>=t.startPos.x&&r>=t.startPos.y){var o=Math.atan(i/e);s=90+o*180/Math.PI}else if(n<t.startPos.x&&r>t.startPos.y){var o=Math.atan(e/i);s=180+o*180/Math.PI}else{var o=Math.atan(i/e);s=270+o*180/Math.PI}var u=0,a=0;s<30||s>330?(u=Math.round(Math.sqrt(e*e+i*i)/t.cellSize),t.endPos=CPMakePoint(t.startPos.x,t.startPos.y-u*t.cellSize),a=1):s>=30&&s<60?(u=Math.round(Math.sqrt(e*e+i*i)/(Math.sqrt(2)*t.cellSize)),t.endPos=CPMakePoint(t.startPos.x+u*t.cellSize,t.startPos.y-u*t.cellSize),a=16):s>=60&&s<120?(u=Math.round(Math.sqrt(e*e+i*i)/t.cellSize),t.endPos=CPMakePoint(t.startPos.x+u*t.cellSize,t.startPos.y),a=4):s>=120&&s<150?(u=Math.round(Math.sqrt(e*e+i*i)/(Math.sqrt(2)*t.cellSize)),t.endPos=CPMakePoint(t.startPos.x+u*t.cellSize,t.startPos.y+u*t.cellSize),a=64):s>=150&&s<210?(u=Math.round(Math.sqrt(e*e+i*i)/t.cellSize),t.endPos=CPMakePoint(t.startPos.x,t.startPos.y+u*t.cellSize),a=2):s>=210&&s<240?(u=Math.round(Math.sqrt(e*e+i*i)/(Math.sqrt(2)*t.cellSize)),t.endPos=CPMakePoint(t.startPos.x-u*t.cellSize,t.startPos.y+u*t.cellSize),a=128):s>=240&&s<300?(u=Math.round(Math.sqrt(e*e+i*i)/t.cellSize),t.endPos=CPMakePoint(t.startPos.x-u*t.cellSize,t.startPos.y),a=8):s>=300&&s<=330&&(u=Math.round(Math.sqrt(e*e+i*i)/(Math.sqrt(2)*t.cellSize)),t.endPos=CPMakePoint(t.startPos.x-u*t.cellSize,t.startPos.y-u*t.cellSize),a=32),t.selectionLen=u+1,t.selectionDir=a,t.display()}else t.endPos=null},12)}}),isTouch()&&(console.log("adding touch"),this.el[0].addEventListener("touchstart",function(e){if(e.touches.length==1){var t=e.touches[0],n="mousedown",r=document.createEvent("MouseEvent");r.initMouseEvent(n,!0,!0,window,1,t.screenX,t.screenY,t.clientX,t.clientY,!1,!1,!1,!1,0,null),t.target.dispatchEvent(r),e.preventDefault()}}),this.el[0].addEventListener("touchmove",function(e){if(e.touches.length==1){var t=e.touches[0],n="mousemove",r=document.createEvent("MouseEvent");r.initMouseEvent(n,!0,!0,window,1,t.screenX,t.screenY,t.clientX,t.clientY,!1,!1,!1,!1,0,null),t.target.dispatchEvent(r),e.preventDefault()}}),this.el[0].addEventListener("touchend",function(e){var t=e.changedTouches,n=t[0],r="mouseup",i=document.createEvent("MouseEvent");i.initMouseEvent(r,!0,!0,window,1,n.screenX,n.screenY,n.clientX,n.clientY,!1,!1,!1,!1,0,null),n.target.dispatchEvent(i),e.preventDefault()}))};WordsearchView.prototype.drawHighlight=function(e,t){var n=document.getElementById("puzzleCanvas"),r=n.getContext("2d");r.lineWidth=1,r.strokeStyle=this.puzzleObject.highlightColor,r.fillStyle=this.puzzleObject.highlightColor,r.beginPath(),r.arc(e.x,e.y-8,this.cellSize/2-2,0,2*Math.PI,!0),r.closePath(),r.fill(),r.lineWidth=this.cellSize-3,r.beginPath(),r.moveTo(e.x,e.y-8),r.lineTo(t.x,t.y-8),r.closePath(),r.stroke(),r.lineWidth=1,r.beginPath(),r.arc(t.x,t.y-8,this.cellSize/2-2,0,2*Math.PI,!0),r.closePath(),r.fill()},WordsearchView.prototype.drawPlacement=function(e){var t=e.x,n=e.y,r=e.word.length,i=e.direction,s=CPMakePoint(t*this.cellSize+12,n*this.cellSize+26),o=null;i==1?o=CPMakePoint(s.x,(n-r+2)*this.cellSize-5):i==2?o=CPMakePoint(s.x,(n+r)*this.cellSize-3):i==4?o=CPMakePoint((t+r)*this.cellSize-18,s.y):i==8?o=CPMakePoint((t-r+1)*this.cellSize+12,s.y):i==16?o=CPMakePoint((t+r)*this.cellSize-18,(n-r+2)*this.cellSize-5):i==32?o=CPMakePoint((t-r+1)*this.cellSize+12,(n-r+2)*this.cellSize-5):i==64?o=CPMakePoint((t+r-.5)*this.cellSize,(n+r)*this.cellSize):i==128&&(o=CPMakePoint((t-r+1)*this.cellSize+12,(n+r)*this.cellSize-3)),o&&this.drawHighlight(s,o)},WordsearchView.prototype.flashHint=function(){if(this._revealcount<this.puzzleObject.placements.length){var e=null;do{var t=Math.floor(Math.random()*this.puzzleObject.placements.length);e=this.puzzleObject.placements[t]}while(e.revealed);var n=this.puzzleObject.cells[e.x+","+e.y],r=this;for(var i=0;i<1400;i+=300)setTimeout(function(){n.ignore=!0,r.display()},i),setTimeout(function(){n.ignore=!1,r.display()},i+150)}},WordsearchView.prototype.isSolved=function(){return this._revealcount==this.puzzleObject.placements.length},WordsearchView.prototype.solve=function(){var e=this.puzzleObject.placements.length;this._revealcount=e;for(var t=0;t<e;t++)this.puzzleObject.placements[t].revealed=!0;this.onSolve(),this.display()},WordsearchView.prototype.checkSelection=function(e,t){var n=this.puzzleObject.placements,r=n.length;for(var i=0;i<r;i++){var s=n[i];if(s.word==t||s.word==t.reverse())return s}return null},WordsearchView.prototype.getSelection=function(e,t,n){var r=e.x,i=e.y,s="";if(t==1)for(var o=i;o>i-n;o--){var u=this.puzzleObject.cells[r+","+o];u&&(s+=u.letter)}else if(t==2)for(var o=i;o<i+n;o++){var u=this.puzzleObject.cells[r+","+o];u&&(s+=u.letter)}else if(t==4)for(var a=r;a<r+n;a++){var u=this.puzzleObject.cells[a+","+i];u&&(s+=u.letter)}else if(t==8)for(var a=r;a>r-n;a--){var u=this.puzzleObject.cells[a+","+i];u&&(s+=u.letter)}else if(t==16)for(var f=0;f<n;f++){var a=r+f,o=i-f,u=this.puzzleObject.cells[a+","+o];u&&(s+=u.letter)}else if(t==32)for(var f=0;f<n;f++){var a=r-f,o=i-f,u=this.puzzleObject.cells[a+","+o];u&&(s+=u.letter)}else if(t==64)for(var f=0;f<n;f++){var a=r+f,o=i+f,u=this.puzzleObject.cells[a+","+o];u&&(s+=u.letter)}else if(t==128)for(var f=0;f<n;f++){var a=r-f,o=i+f,u=this.puzzleObject.cells[a+","+o];u&&(s+=u.letter)}return s},WordsearchView.prototype.clear=function(){var e=this.puzzleObject.placements.length;this._revealcount=0;for(var t=0;t<e;t++)this.puzzleObject.placements[t].revealed=!1;this.display()},WordsearchView.prototype.display=function(){var e=document.getElementById("puzzleCanvas"),t=e.getContext("2d");t.clearRect(0,0,e.width,e.height);if(this.puzzleObject){var n=this.puzzleObject.placements.length;for(var r=0;r<n;r++)this.puzzleObject.placements[r].revealed&&this.drawPlacement(this.puzzleObject.placements[r]);this.endPos&&this.drawHighlight(this.startPos,this.endPos);var i=this.puzzleObject.rect;for(var s=i.origin.x;s<i.origin.x+i.size.width;s++)for(var o=i.origin.y;o<i.origin.y+i.size.height;o++){var u=s+","+o,a=this.puzzleObject.cells[u];if(a&&a.letter&&a.letter!="\0"&&!a.ignore){var f=5+this.cellSize*(a.x-i.origin.x),l=5+this.cellSize*(a.y-i.origin.y),c=this.puzzleObject.fontSize?this.puzzleObject.fontSize:18,h=this.puzzleObject.fontFamily?this.puzzleObject.fontFamily:"Arial";t.font=c+"px "+h+", sans-serif",t.fillStyle=this.puzzleObject.letterColor,t.fillText(""+a.letter,f,l+18)}}}};var isTouch=function(){return jQuery.support.touch};$(function(){function f(){$("#clues").empty();var e="<table id='cluesTable'><tr><th class='cluesHeader'>"+PUZZLEOBJ.wordbankLabel+"</th></tr>",t=PUZZLEOBJ.placements.length,n=0;for(;n<t;n++){var r=PUZZLEOBJ.placements[n],i=r.text?r.text:r.word;r.revealed?e+="<tr class='clueRow'><td>&nbsp;<font style='text-decoration:line-through;'>"+i+"</font></td></tr>":e+="<tr class='clueRow'><td>&nbsp;"+i+"</td></tr>"}e+="</table>",$("#clues").html(e)}window.document.title=PUZZLEOBJ.title,PUZZLEOBJ.hasInstructions&&($("#instructions").html(PUZZLEOBJ.instructions),$("#instructions").show(),$("body").bind("vmousedown",function(){$("#instructions").hide()}));var e=PUZZLEOBJ,t="puzzleObject_"+PUZZLEOBJ.puzzleID;localStorage&&localStorage[t]!==undefined&&PUZZLEOBJ.iBooks&&(e=JSON.parse(localStorage[t])),$("#showAnswersBtn").text(PUZZLEOBJ.checkAnswersLabel),$("#solveBtn").text(PUZZLEOBJ.solveButtonLabel),$("#hintBtn").text(PUZZLEOBJ.hintButtonLabel),$("#clearBtn").css("background-image","url(data:image/png;base64,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)"),PUZZLEOBJ.iBooks&&$("#solveBtn").css("margin-left",60),PUZZLEOBJ.hasSolveButton||($("#solveBtn").hide(),$("#hintBtn").css("margin-left",60)),PUZZLEOBJ.hasHintButton||$("#hintBtn").hide();var n=$("#notify");$("#solveBtn").bind("vclick",function(){o.solve()}),$("#hintBtn").bind("vclick",function(){o.flashHint()}),$("#clearBtn").bind("vclick",function(){o.clear(),f(),u=0,n.hide()});var r=PUZZLEOBJ.cellSize?PUZZLEOBJ.cellSize:27,i=$("#puzzle");i.css("width",r*PUZZLEOBJ.rect.size.width+16),i.css("height",r*PUZZLEOBJ.rect.size.height+16);var s=document.getElementById("puzzleCanvas");s.width=$("#puzzle").width(),s.height=$("#puzzle").height();var o=new WordsearchView({puzzleObject:e,cellSize:r});o.onWordFound=function(){f()},o.onSolve=function(){n.text(PUZZLEOBJ.successMessage),n.show()},o.display(),f(),$("#center").css("background",PUZZLEOBJ.backgroundColor),PUZZLEOBJ.imageBackground&&$("#center").css("background","url(image.png) no-repeat center");if(PUZZLEOBJ.hasTimer){var u=0,a=$("#timer");a.show(),setInterval(function(){if(!o.isSolved()){var e=Math.floor(u/60),t=u-60*e;t<10&&(t="0"+t),a.html(e+":"+t),u++}},1e3)}PUZZLEOBJ.iBooks&&setInterval(function(){localStorage&&(localStorage[t]=JSON.stringify(o.puzzleObject))},50),window.onbeforeunload=function(){return""}})
